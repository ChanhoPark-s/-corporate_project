<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.spring.mapper.ItemMapper">

	<select id="selectAll" resultType="com.spring.domain.ItemVO">
		select i.no no, i.code code, c.code as client_code, i.name, i.in_price, i.out_price, i.image
		from item i
		inner join client c
		on i.client_no=c.no
		order by 1
	</select>
	<insert id="insert">
		insert into item
		values (item_seq.nextval,#{client_no},#{code}, #{name}, #{in_price}, #{out_price}, #{image})
	</insert>
	
	<delete id="delete">
		delete item where no = #{no}
	</delete>
	
	<select id="selectOne" resultType="com.spring.domain.ItemVO">
		select * from item where no=#{value}
	</select>
	
	<update id="update">
		update item set client_no=#{client_no}, code=#{code}, name=#{name}, in_price=#{in_price}, out_pirce=#{out_price}, image=#{image}
		where no=#{no}
	</update>
	
	<!-- 이하 ajax API 관련 SQL -->
	<select id="getListWithPaging" resultType="com.spring.domain.ItemVO">
		<![CDATA[
		select no, code, name, client_name, in_price, out_price, image
		from(
		    select rownum rn, i.no, i.code, i.name, c.name client_name, i.in_price, i.out_price, i.image
    		from item i inner join client c
    		on i.client_no = c.no
		    where rownum <= #{cri.pageNum} * #{cri.amount}
		]]>
		
		    <if test="cri.whatColumn=='code' and cri.keyword != null"> and i.code like '%' ||  #{cri.keyword} || '%' </if>
			<if test="cri.whatColumn=='name' and cri.keyword != null"> and i.name like '%' ||  #{cri.keyword} || '%' </if>
			<if test="cri.whatColumn=='client_name' and cri.keyword != null"> and c.name like '%' ||  #{cri.keyword} || '%' </if>
		    
		<![CDATA[    
			order by no
		)where rn > (#{cri.pageNum} - 1) * #{cri.amount}
		]]> 
	</select>
	
	<select id="getCountAll" resultType="int">
		select count(*)
		from(
	        select *
	        from(
				select rownum rn, i.no, i.code, i.name, c.name client_name, i.in_price, i.out_price, i.image
		    	from item i inner join client c
		    	on i.client_no = c.no)
		)where no > 0
		
		<if test="cri.whatColumn=='code' and cri.keyword != null"> and code like '%' ||  #{cri.keyword} || '%' </if>
		<if test="cri.whatColumn=='name' and cri.keyword != null"> and name like '%' ||  #{cri.keyword} || '%' </if>
		<if test="cri.whatColumn=='client_name' and cri.keyword != null"> and client_name like '%' ||  #{cri.keyword} || '%' </if>
		
	</select>
</mapper>